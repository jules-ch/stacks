version: '3.7'

services:
  web:
    image: ghost:2.31-alpine
    volumes:
      - ghost:/var/lib/ghost/content:nocopy
    environment:
      url: https://${DOMAIN_GHOST:?err}
    deploy:
      labels:
        traefik.enable: "true"
        traefik.http.routers.ghost.entrypoints: http
        traefik.http.routers.ghost.rule: Host(`${DOMAIN_GHOST:?err}`)
        traefik.http.routers.ghost.middlewares: redirect-https
        traefik.http.routers.ghost-secure.entrypoints: http
        traefik.http.routers.ghost-secure.rule: Host(`${DOMAIN_GHOST:?err}`)
        traefik.http.routers.ghost-secure.tls.certresolver: letsencrypt
        traefik.http.services.ghost-service.loadbalancer.server.port: "2368"

volumes:
  ghost:

networks:
  default:
    name: traefik-net
    external: true